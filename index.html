<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Timothy Fund Uganda | Blog</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&family=Playfair+Display:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- Video.js CSS -->
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <!-- Quill Editor CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
</head>

<body>
    <header class="app-header">
        <div class="header-content">
            <h1 class="logo">Project Timothy Fund <span>Uganda</span></h1>
            <nav id="main-nav">
                <a href="#home" class="nav-link">Latest Post</a>
                <a href="#archive" class="nav-link">Previous Posts</a>
                <div id="admin-link-container"></div>
            </nav>
        </div>
    </header>

    <main id="app-viewport">
        <!-- Views will be injected here -->
        <section id="home-view" class="view">
            <div id="latest-post-container">
                <div class="loader">Loading latest update...</div>
            </div>
        </section>

        <section id="archive-view" class="view hidden">
            <div class="section-header">
                <h2>Previous Posts</h2>
            </div>
            <div id="archive-grid" class="grid"></div>
        </section>

        <section id="post-view" class="view hidden">
            <div id="post-content"></div>
            <div id="comments-section" class="comments-section">
                <h3 class="comments-title">Supporter comments</h3>
                <div id="comments-list"></div>
                <form id="comment-form" class="comment-form">
                    <input type="text" id="comment-author" placeholder="Your Name" required>
                    <textarea id="comment-text" placeholder="Send a comment" required></textarea>
                    <button type="submit" class="btn btn-primary">Send</button>
                </form>
            </div>
        </section>

        <section id="admin-login-view" class="view hidden">
            <div class="admin-card">
                <h2>Admin Login</h2>
                <form id="login-form">
                    <input type="email" id="login-email" placeholder="Admin Email" required>
                    <input type="password" id="login-password" placeholder="Password" required>
                    <button type="submit" class="btn btn-primary">Login</button>
                </form>
            </div>
        </section>


        <section id="admin-dashboard-view" class="view hidden">
            <div class="admin-layout">
                <nav class="admin-navbar">
                    <div class="navbar-content">
                        <div class="navbar-brand">
                            <h3>Admin Panel</h3>
                        </div>
                        <button id="btn-hamburger" class="hamburger-btn" aria-label="Menu">
                            <span></span>
                            <span></span>
                            <span></span>
                        </button>
                        <div class="navbar-menu" id="admin-navbar-menu">
                            <button id="btn-nav-new-post" class="navbar-btn primary-nav-btn">
                                <span class="nav-icon">‚ú®</span> New Post
                            </button>
                            <a href="#admin/comments" class="navbar-item" data-route="comments">
                                <span class="nav-icon">üí¨</span> Moderation
                            </a>
                        </div>
                    </div>
                </nav>
                <main id="admin-content" class="admin-main">
                    <!-- Admin subsections -->
                </main>
                <footer class="admin-footer">
                    <div id="storage-usage-container" class="storage-usage-footer">
                        <div class="storage-info">
                            <span class="storage-label">Storage Usage:</span>
                            <span id="storage-value">---</span>
                        </div>
                        <button id="btn-refresh-storage" class="btn-refresh" title="Refresh usage">üîÑ</button>
                        <button id="btn-purge-storage" class="btn-purge" title="Purge orphaned files"
                            onclick="purgeOrphanedFiles()">üóëÔ∏è Purge</button>
                    </div>
                    <div class="app-version">v1.0.077</div>
                </footer>
            </div>
        </section>

        <section id="admin-edit-view" class="view hidden">
            <div class="edit-page-layout">
                <header class="edit-page-header">
                    <div class="header-top">
                        <button class="btn btn-text" onclick="window.location.hash='#admin/posts'">‚Üê Back to
                            Dashboard</button>
                    </div>
                    <h1 id="edit-view-title">Post Title</h1>
                </header>
                <div id="edit-view-content">
                    <!-- Admin Edit Content -->
                </div>
            </div>
        </section>

        <!-- Audio Recorder Modal -->
        <div id="modal-audio-recorder" class="modal hidden">
            <div class="modal-content recorder-modal">
                <h3>Record Audio Snippet</h3>
                <div class="recorder-container">
                    <canvas id="waveform" width="400" height="100"></canvas>
                    <div class="timer" id="recording-timer">00:00</div>
                </div>
                <div class="input-group" style="margin-bottom: 1.5rem;">
                    <label for="audio-record-title">Recording Title</label>
                    <input type="text" id="audio-record-title" placeholder="Recording Title"
                        style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid #ddd;">
                </div>
                <div class="modal-actions">
                    <button id="btn-start-record" class="btn btn-primary">Start Recording</button>
                    <button id="btn-stop-record" class="btn btn-secondary hidden">Stop</button>
                    <button id="btn-save-record" class="btn btn-primary hidden">Save & Upload</button>
                    <button id="btn-cancel-record" class="btn btn-text">Cancel</button>
                </div>
            </div>
        </div>
        <!-- Video Uploader Modal -->
        <div id="modal-video-uploader" class="modal hidden">
            <div class="modal-content card">
                <h3>Add/Edit Video</h3>
                <div class="input-group" style="margin-top: 1rem;">
                    <label>Video File (MP4, WebM, AVI)</label>
                    <div class="upload-zone" id="video-upload-zone">
                        <p>üé• Click to select a video file</p>
                        <input type="file" id="video-file-input" accept="video/*" hidden>
                    </div>
                    <small style="color: #64748b; display: block; margin-top: 0.5rem;">* AVI files may not be compatible
                        with all browsers. MP4 is recommended.</small>
                </div>

                <div class="input-group" style="margin-top: 1rem;">
                    <label>Video Description</label>
                    <textarea id="video-description" placeholder="Video description..."
                        style="min-height: 100px;"></textarea>
                </div>

                <div id="video-upload-status" style="margin-top: 1rem; color: var(--color-orange); font-weight: 500;">
                </div>

                <div class="modal-actions">
                    <button class="btn btn-text" id="btn-cancel-video">Cancel</button>
                    <button class="btn btn-primary" id="btn-save-video">Upload & Tag Slide</button>
                    <button class="btn btn-text delete hidden" id="btn-delete-video">Remove Video</button>
                </div>
            </div>
        </div>

        <!-- New Post Modal (Global) -->
        <div id="modal-new-post" class="modal hidden">
            <div class="modal-content card">
                <h3>Create New Post</h3>
                <div class="input-group">
                    <label>Post Title</label>
                    <input type="text" id="new-post-title" placeholder="Post Title">
                </div>

                <div class="upload-options" style="display: flex; gap: 1rem; margin: 1rem 0;">
                    <div class="upload-zone" id="upload-zone-folder" style="flex: 1;">
                        <p>üìÅ Select Folder</p>
                        <input type="file" id="folder-input" webkitdirectory directory multiple
                            accept="image/png,application/pdf" hidden>
                    </div>
                    <div class="upload-zone" id="upload-zone-files" style="flex: 1;">
                        <p>üñºÔ∏è Select Files</p>
                        <input type="file" id="files-input" multiple accept="image/png,application/pdf" hidden>
                    </div>
                </div>

                <div id="upload-preview" class="upload-preview grid"></div>

                <div class="modal-actions">
                    <button class="btn btn-text" id="btn-cancel-post">Cancel</button>
                    <button class="btn btn-primary" id="btn-save-post">Create Post & Upload</button>
                </div>
            </div>
        </div>
    </main>

    <footer class="app-footer">
        <div class="version">v1.0.077</div>
        <p>&copy; 2026 Project Timothy Fund Uganda</p>
    </footer>

    <!-- Custom Notifications Container -->
    <div id="notification-container" class="notification-container"></div>

    <!-- Custom Confirm Modal -->
    <div id="modal-confirm" class="modal hidden">
        <div class="modal-content card confirm-modal">
            <h3 id="confirm-title">Confirm Action</h3>
            <p id="confirm-message" style="margin: 1.5rem 0; color: var(--color-dark); opacity: 0.8;"></p>
            <div class="modal-actions" style="justify-content: flex-end; gap: 1rem;">
                <button class="btn btn-text" id="btn-confirm-cancel">Cancel</button>
                <button class="btn btn-primary" id="btn-confirm-ok">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Custom Prompt Modal -->
    <div id="modal-prompt" class="modal hidden">
        <div class="modal-content card confirm-modal">
            <h3 id="prompt-title">Input Required</h3>
            <p id="prompt-message" style="margin: 1rem 0; color: var(--color-dark); opacity: 0.8;"></p>
            <div class="input-group" style="margin-bottom: 1.5rem;">
                <input type="text" id="prompt-input" style="width: 100%;">
            </div>
            <div class="modal-actions" style="justify-content: flex-end; gap: 1rem;">
                <button class="btn btn-text" id="btn-prompt-cancel">Cancel</button>
                <button class="btn btn-primary" id="btn-prompt-ok">Submit</button>
            </div>
        </div>
    </div>

    <!-- Document Editor Modal -->
    <div id="modal-document-editor" class="modal hidden">
        <div class="modal-content document-editor-modal">
            <div class="document-editor-header">
                <h3>Document Editor</h3>
                <button class="btn-close-modal" onclick="closeDocumentEditor()">‚úï</button>
            </div>
            <div id="quill-toolbar" class="quill-toolbar">
                <!-- Quill Toolbar -->
                <select class="ql-header">
                    <option value="1">Heading 1</option>
                    <option value="2">Heading 2</option>
                    <option value="3">Heading 3</option>
                    <option selected>Normal</option>
                </select>
                <button class="ql-bold"></button>
                <button class="ql-italic"></button>
                <button class="ql-underline"></button>
                <select class="ql-color"></select>
                <select class="ql-background"></select>
                <button class="ql-link"></button>
                <button class="ql-list" value="ordered"></button>
                <button class="ql-list" value="bullet"></button>
                <button class="ql-image" title="Insert Image"></button>
                <button class="ql-clean"></button>
            </div>
            <div id="quill-editor-container" class="quill-editor-container"></div>
            <input type="hidden" id="document-slide-id">
            <input type="file" id="document-image-upload" accept="image/*" style="display: none;">
            <div class="modal-actions">
                <button class="btn btn-text" onclick="closeDocumentEditor()">Cancel</button>
                <button class="btn btn-primary" id="btn-save-document">Save Document</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <!-- Quill Editor JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quill-image-resize-module@3.0.0/image-resize.min.js"></script>
    <!-- AWS SDK for JavaScript (S3 Client) is loaded dynamically in app.js -->
    <script src="js/config.js"></script>
    <!-- PDF.js for PDF to Slide conversion -->
    <script src="https://unpkg.com/pdfjs-dist@4.0.379/build/pdf.min.mjs" type="module"></script>
    <script src="js/app.js" type="module"></script>
</body>

</html>